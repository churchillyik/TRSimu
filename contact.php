<?phpinclude("GameEngine/Village.php");include("Templates/time_start.tpl");if (isset($_GET['newdid'])){	$_SESSION['wid'] = $_GET['newdid'];	header("Location: ".$_SERVER['PHP_SELF']);}?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head>	<title><?php echo SERVER_NAME ?></title>    <link REL="shortcut icon" HREF="favicon.ico"/>	<meta http-equiv="cache-control" content="max-age=0" />	<meta http-equiv="pragma" content="no-cache" />	<meta http-equiv="expires" content="0" />	<meta http-equiv="imagetoolbar" content="no" />	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />	<script src="mt-full.js?0faaa" type="text/javascript"></script>	<script src="unx.js?0faaa" type="text/javascript"></script>	<script src="new.js?0faaa" type="text/javascript"></script>	<link href="gpack/travian_basic/lang/en/compact.css?e21d2" rel="stylesheet" type="text/css" />	<link href="gpack/travian_basic/lang/en/lang.css?e21d2" rel="stylesheet" type="text/css" />	<?php	if ($session->gpack == null || GP_ENABLE == false)	{		echo "		<link href='".GP_LOCATE."travian.css?e21d2' rel='stylesheet' type='text/css' />		<link href='".GP_LOCATE."lang/en/lang.css?e21d2' rel='stylesheet' type='text/css' />";	}	else	{		echo "		<link href='".$session->gpack."travian.css?e21d2' rel='stylesheet' type='text/css' />		<link href='".$session->gpack."lang/en/lang.css?e21d2' rel='stylesheet' type='text/css' />";	}	?>		<script type="text/javascript">		window.addEvent('domready', start);	</script></head><body class="v35 ie ie8"><div class="wrapper">	<img style="filter:chroma();" src="img/x.gif" id="msfilter" alt="" />	<div id="dynamic_header"></div>	<?php include("Templates/header.tpl"); ?>	<div id="mid">		<?php include("Templates/menu.tpl"); ?>		<div id="content" class="warsim">			<h1>联系我们</h1>			<?php			//	联系电邮地址，多个用逗号隔开			$contact_to_email = "476418125@qq.com";			//	电邮标题			$contact_subject = "联系我们：";			//	内部地址			$contact_from_email = "kill1028@126.com";			//	内部名称			$contact_from_name = "TravianX";			//=======================================			//			//	下面为可选选项			//			//=======================================			//	如果为false，电邮来自于发件人，否则来自于内部地址			$send_from_internal_address = false;			//	出错信息颜色			$error_color = "red";			//	是否使用验证图片			$use_security_image = false;			function previous_request_value($str)			{				if (isset($_REQUEST[$str]))				{					return $_REQUEST[$str];				}				else				{					return '';				}			}			function cndstrips($str)			{				if (get_magic_quotes_gpc())				{					return stripslashes($str);				}				else				{					return $str;				}			}			//$visitor_email = $database->getUserField($_SESSION['username'], "email", 1);			//$visitor_name = $session->username;			$visitor_email = cndstrips(previous_request_value('visitor_email'));			$visitor_name = cndstrips(previous_request_value('visitor_name'));			$message_body = cndstrips(previous_request_value('message_body'));			$message_subject = cndstrips(previous_request_value('message_subject'));			$security_code = str_replace(' ', '', cndstrips(trim(previous_request_value('security_code'))));			$errors = "";			$message_sent = false;			function validate_email($email)			{				return preg_match('/^[A-Za-z0-9_\-\.]+@[A-Za-z0-9_\-\.]+\.[A-Za-z0-9_\-\.]+$/', $email) == 0;			}			if ($_SERVER['REQUEST_METHOD'] == 'POST')			{				if (validate_email($visitor_email))				{					$errors .= "请在user@place.ext文本框内输入一个有效的电邮地址<br/><br/>";				}				if ($use_security_image 					&& (strtolower($security_code) != strtolower($_SESSION['contact_form_security_code']) 					|| $_SESSION['contact_form_security_code'] == ''))				{					$errors .= "验证码输入错误，请重新输入。<br/><br/>";				}				if ($message_body == '')				{					$errors .= "请输入邮件的内容<br/><br/>";				}				if ($message_subject == '')				{					$errors .= "请输入邮件的主题<br/><br/>";				}				if ($visitor_name == '')				{					$visitor_name = $session->username;				}				if (!$errors)				{					$ip = $_SERVER["REMOTE_ADDR"];					$httpagent = $_SERVER["HTTP_USER_AGENT"];					$time = date("D, F j, Y H:i O");					if ($visitor_name)					{						$visitor_name_and_email = "$visitor_name <$visitor_email>";					}					else					{						$visitor_name_and_email = "$visitor_email";					}					if ($contact_from_name)					{						$contact_from_email = "$contact_from_name <$contact_from_email>";					}					$message = "					$message_body\r\n					____________________________\r\n					浏览器信息：$ip $httpagent					";					if ($send_from_internal_address)					{						$message = "						来自: $visitor_name_and_email\r\n						日期: $time\r\n						标题: $message_subject\r\n						".$message;					}					if ($send_from_internal_address)					{						mail($contact_to_email, $contact_subject.$message_subject, $message, 						"From: ".$contact_from_email."\r\n"."Reply-To: ".$visitor_name_and_email."\r\n");					}					else					{						mail($contact_to_email, $contact_subject.$message_subject, $message, 						"From: ".$visitor_name_and_email."\r\n");					}					echo "您的邮件";					echo "<div style='border: 1px solid black; margin: 10px 10px 10px 10px; padding: 10px 10px 10px 10px;'>来自：".htmlentities($visitor_name_and_email, ENT_QUOTES, 'UTF-8')					."<br />回复：".htmlentities($message_subject, ENT_QUOTES, 'UTF-8')					."<br />".htmlentities($message_body, ENT_QUOTES, 'UTF-8')."</div>";					echo "已经成功发送，感谢您对我们工作的支持。";					$message_sent = true;				}			}			if (!$message_sent)			{				$this_file = substr(strrchr($_SERVER['PHP_SELF'], "/"), 1);			?>				<form name="ContactForm" id="ContactForm" method="post" action="<?php echo $this_file ?>">					我们很高兴收到您的来信，请在下面的输入框中输入您的需求内容<?php if (!$message_body) echo "和信息" ?>，然后点击发送按钮。					<br />					<br />					<?php					if ($errors)					{						echo "<span style='color:$error_color'><br />$errors</span>";					}					?>					<label for="visitor_name">你的名字<font color="Red">*</font></label><br />					<input name="visitor_name" type="text" id="visitor_name" value="<?php echo $session->username; ?>" size="25" />					<br /><br />					<label for="visitor_name">你的电邮地址<font color="Red">*</font></label><br />					<input name="visitor_email" type="text" id="visitor_email" value="<?php echo $database->getUserField($_SESSION['username'], "email", 1); ?>" size="25"/>					<br /><br />					<label for="message_subject">主题<font color="Red">*</font></label><br />					<input name="message_subject" type="text" id="message_subject" value="<?php echo htmlentities($message_subject, ENT_QUOTES, 'UTF-8') ?>" size="25"/>					<br /><br />					<?php					if ($use_security_image)					{					?>						<div id="security">							<img src="securityimage/security-image.php?width=200" width="200" height="40" alt="验证码" />						</div>						验证图片（请输入图片中的验证码）<br />						<input name="security_code" type="text" id="security_code" size="25"/>						<br /><br />					<?php					}					?>					<label for="message_body">邮件内容<font color="Red">*</font></label><br />					<textarea name="message_body" cols="30" rows="6" id="message_body" ><?php echo htmlentities($message_body) ?></textarea>					<br /><br />					<input type="submit" name="Submit" value="发送" />				</form>			<?php			}			?>			<br /><br />			<font size="1" color="gray">标记有 <font color="Red">*</font> 的内容是必须填写的！</font>		</div>	</div>	<div id="side_info">		<?php		include("Templates/quest.tpl");		include("Templates/news.tpl");		include("Templates/multivillage.tpl");		include("Templates/links.tpl");		?>	</div>	<div class="clear"></div>	<div class="footer-stopper"></div>	<div class="clear"></div>	<?php 	include("Templates/footer.tpl"); 	include("Templates/res.tpl");	include("Templates/time.tpl");	?>		<div id="ce"></div></div></body></html>